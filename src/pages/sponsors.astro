---
import { contentfulClient } from '../lib/contentful';
import MainLayout from '../layouts/MainLayout.astro';
import ImageHeader from '../components/ImageHeader.astro';
import YearSelector from '../components/About/YearSelector.astro';
import SponsorBlock from '../components/Sponsorship/Sponsors.astro';

interface Sponsor {
  fields: {
    title: string;
    paragraph: string;
    image: {
      fields: {
        file: {
          url: string;
        };
      };
    };
    order: number;
    fadeDirection: string;
  };
  contentTypeId: string;
}

const sponsorsResponse = await contentfulClient.getEntries<Sponsor>({
  content_type: 'sponsor',
  //@ts-ignore
  order: '-fields.order',
});
---

<MainLayout title="Knight Owls - Our Sponsors">
  <ImageHeader
    title="Our Amazing Sponsors"
    background="/images/headers/sponsors.webp"
  />
  <YearSelector />
  <SponsorBlock classes="showDefault" year="year2" filename="2022-23" />
  <SponsorBlock year="year1" filename="2021-22" />

  <script>
    // Get the element with the id of "yearselector"
    const selector = document.getElementById(
      'yearselector'
    ) as HTMLSelectElement;
    // When the selector changes, change the year to the selected year
    selector.addEventListener('change', function () {
      let newactive = document.querySelector('#' + this.value) as HTMLElement;
      let oldactive = document.querySelector('.sponsors') as HTMLElement;
      removeClass();
      newactive.classList.add('showDefault');
      oldactive.animate([{ opacity: '1' }, { opacity: '.5' }], {
        duration: 1000,
      });
      newactive.animate([{ opacity: '.2' }, { opacity: '1' }], {
        duration: 1000,
      });
    });
    function removeClass() {
      var allElements = document.querySelectorAll('.showDefault');
      for (let i = 0; i < allElements.length; i++) {
        allElements[i].classList.remove('showDefault');
      }
    }
  </script>
</MainLayout>
